{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the Smart Digital Campus platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "role": {
          "type": "string",
          "description": "User's role within the system (e.g., 'student', 'teacher', 'admin', 'parent')."
        },
        "profileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: User 1:1 UserProfile)"
        },
        "wellBeingIds": {
          "type": "array",
          "description": "References to WellBeingCheckIns. (Relationship: User 1:N WellBeingCheckIn)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "email",
        "displayName",
        "role",
        "profileId"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Detailed profile information for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "jurusan": {
          "type": "string",
          "description": "User's major or field of study."
        },
        "kelas": {
          "type": "string",
          "description": "User's class or grade level."
        },
        "houseId": {
          "type": "string",
          "description": "Reference to House. (Relationship: UserProfile 1:1 House)"
        },
        "points": {
          "type": "number",
          "description": "Gamification points earned by the user."
        },
        "skillTree": {
          "type": "string",
          "description": "JSON object representing the user's skill tree progress."
        },
        "parentIds": {
          "type": "array",
          "description": "References to Users who are parents of this student. (Relationship: UserProfile 1:N User)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "houseId"
      ]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a course or subject offered within the platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the course."
        },
        "name": {
          "type": "string",
          "description": "Name of the course."
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to User who is teaching the course. (Relationship: User 1:N Course)"
        },
        "studentIds": {
          "type": "array",
          "description": "References to Users enrolled in the course. (Relationship: Course 1:N User)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "teacherId"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a student project or assignment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project."
        },
        "title": {
          "type": "string",
          "description": "Title of the project."
        },
        "description": {
          "type": "string",
          "description": "Description of the project."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to User who authored the project. (Relationship: User 1:N Project)"
        },
        "authorName": {
          "type": "string",
          "description": "Name of the author (denormalized)."
        },
        "authorAvatar": {
          "type": "string",
          "description": "URL of the author's avatar (denormalized).",
          "format": "uri"
        },
        "files": {
          "type": "array",
          "description": "Links to files stored in Firebase Storage.",
          "items": {
            "type": "string"
          }
        },
        "collaboratorIds": {
          "type": "array",
          "description": "References to Users collaborating on the project. (Relationship: Project 1:N User)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "authorId"
      ]
    },
    "PpdbApplication": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PpdbApplication",
      "type": "object",
      "description": "Represents an application for student admission (PPDB).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the PPDB application."
        },
        "fullName": {
          "type": "string",
          "description": "Full name of the applicant."
        },
        "status": {
          "type": "string",
          "description": "Status of the application (e.g., 'pending', 'verified')."
        }
      },
      "required": [
        "id",
        "fullName",
        "status"
      ]
    },
    "Announcement": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Announcement",
      "type": "object",
      "description": "Represents an announcement or notification.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the announcement."
        },
        "title": {
          "type": "string",
          "description": "Title of the announcement."
        },
        "content": {
          "type": "string",
          "description": "Content of the announcement."
        },
        "targetAudience": {
          "type": "array",
          "description": "Target audience for the announcement (e.g., ['student', 'teacher']).",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the announcement was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "content"
      ]
    },
    "House": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "House",
      "type": "object",
      "description": "Represents a house within the gamified house system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the house."
        },
        "name": {
          "type": "string",
          "description": "Name of the house."
        },
        "totalPoints": {
          "type": "number",
          "description": "Total points earned by the house."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "WellBeingCheckIn": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WellBeingCheckIn",
      "type": "object",
      "description": "Represents a student's well-being check-in record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the check-in record."
        },
        "mood": {
          "type": "number",
          "description": "Student's mood rating (e.g., 1-5)."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the check-in was recorded.",
          "format": "date-time"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N WellBeingCheckIn)"
        }
      },
      "required": [
        "id",
        "mood",
        "timestamp",
        "userId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection for all users. User documents are secured via path-based rules, ensuring a user can only access their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/profile",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Subcollection for user profiles, nested under the users collection. Securing profile data using path based rules. Read/write access is limited to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/wellBeing/{wellBeingId}",
        "definition": {
          "entityName": "WellBeingCheckIn",
          "schema": {
            "$ref": "#/backend/entities/WellBeingCheckIn"
          },
          "description": "Subcollection for user well-being check-ins, nested under the users collection.  Secured by path based rules. Access is restricted to the user who owns the check-in data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "wellBeingId",
              "description": "The unique identifier for the well-being check-in."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Collection for courses. The studentIds is an array of user IDs enrolled in this course. The teacherId defines the teacher of the course.  Access control: Teachers can manage their courses, and students can access courses they are enrolled in.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Collection for student projects. Includes denormalized 'authorName' and 'authorAvatar' for authorization independence and efficient data retrieval.  Access control: Only the author and listed collaborators can access or modify the project.",
          "params": [
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/ppdbApplications/{ppdbApplicationId}",
        "definition": {
          "entityName": "PpdbApplication",
          "schema": {
            "$ref": "#/backend/entities/PpdbApplication"
          },
          "description": "Collection for PPDB applications. Access control: Limited to authorized personnel for managing applications.",
          "params": [
            {
              "name": "ppdbApplicationId",
              "description": "The unique identifier for the PPDB application."
            }
          ]
        }
      },
      {
        "path": "/announcements/{announcementId}",
        "definition": {
          "entityName": "Announcement",
          "schema": {
            "$ref": "#/backend/entities/Announcement"
          },
          "description": "Collection for announcements.  Access control: Creation and deletion limited to admins. Read access is public but can be filtered based on targetAudience.",
          "params": [
            {
              "name": "announcementId",
              "description": "The unique identifier for the announcement."
            }
          ]
        }
      },
      {
        "path": "/houses/{houseId}",
        "definition": {
          "entityName": "House",
          "schema": {
            "$ref": "#/backend/entities/House"
          },
          "description": "Collection for houses. Access control: Limited to authorized personnel for managing house data.",
          "params": [
            {
              "name": "houseId",
              "description": "The unique identifier for the house."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the features of the Smart Digital Campus platform, emphasizing real-time data synchronization, user personalization, and collaborative workspaces. Authorization Independence is achieved through strategic denormalization, specifically within the `projects` collection, where `authorName` and `authorAvatar` are copied to avoid `get()` calls in security rules. This also applies to courses. The structure also accounts for role-based access control and data ownership. Segregation of data into collections like `users`, `courses`, `projects`, `ppdbApplications`, `announcements`, and `houses` ensures that each collection can have tailored security rules, preventing unintended data access. The use of subcollections for user-specific data (`users/{userId}/wellBeing`) maintains clear ownership. The membership map pattern is inherent within courses, where studentIds array defines the group membership.\n\nTo support QAPs (Rules are not Filters): Access to the `projects` collection is secured by ensuring that listing projects is based on individual access to a project, thus requiring the user to be either the author or a collaborator. Announcements can be configured with target audiences to ensure only relevant users are listed in their announcements.\n\nOwnership and referential integrity are maintained through explicit `userId` fields in `WellBeingCheckIn` documents and `teacherId` in the `Course` documents."
  }
}